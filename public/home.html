<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>UniGuide - Find Your Future</title>
  <link rel="stylesheet" href="home.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet"/>
  
  <style>
    .search-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      max-height: 400px;
      overflow-y: auto;
      z-index: 1000;
      margin-top: 0.5rem;
      display: none;
    }
    .search-dropdown.show {
      display: block;
    }
    .search-group {
      position: relative;
    }
    .dropdown-item {
      padding: 1rem 1.5rem;
      cursor: pointer;
      border-bottom: 1px solid #f1f5f9;
      transition: all 0.2s;
    }
    .dropdown-item:hover {
      background: linear-gradient(135deg, #dbeafe, #e0e7ff);
    }
    .dropdown-item:last-child {
      border-bottom: none;
    }
    .program-name {
      font-weight: 600;
      color: #1e40af;
      margin-bottom: 0.3rem;
    }
    .program-meta {
      font-size: 0.9rem;
      color: #64748b;
    }
    .no-results {
      padding: 1.5rem;
      text-align: center;
      color: #94a3b8;
    }
    .nav-link {
  margin-left: 2.5rem;
  font-weight: 600;
  color: #475569;
  text-decoration: none;
  position: relative;
  transition: color 0.3s;
}

.nav-link::after {
  content: '';
  position: absolute;
  width: 0;
  height: 2px;
  bottom: -6px;
  left: 0;
  background: #3b82f6;
  transition: width 0.4s ease;
}

.nav-link:hover {
  color: #3b82f6;
}

.nav-link:hover::after {
  width: 100%;
}
  </style>
</head>
<body>

  <header class="header">
    <div class="container header-content">
      <div class="logo">
        <span class="logo-text">UniGuide</span>
      </div>
      <nav class="nav">
       <a href="home.html" class="nav-link">Home</a>
        <a href="deadlines.html" class="nav-link">Deadlines</a>
        <a href="aggregateCalculator.html" class="nav-link">Aggregate Calculator</a>
        <a href="compare.html" class="nav-link">Compare Universities</a>
        <a href="chat.html" class="nav-link">AI Chat</a>
      </nav>
    </div>
  </header>

  <section class="hero">
    <div class="container hero-content">
      <h1>Find Your Future.</h1>
      <p class="subtitle">Explore universities and programs across Pakistan.</p>

      <div class="search-section">
        <h2>Search Programs</h2>
        <div class="search-boxes">
          <div class="search-group">
            <label>Enter Program (e.g. CS, BBA, MBBS)</label>
            <input type="text" placeholder="Type to search programs..." class="search-input" id="program-input" autocomplete="off"/>
            <div class="search-dropdown" id="program-dropdown"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="institutions">
    <div class="container">
      <h2 class="section-title">Explore Top Institutions</h2>
      
      <div id="loading" class="loading">Loading universities from database...</div>
      <div id="error" class="error" style="display:none; color:red; text-align:center;"></div>

      <div class="cards-grid" id="universities-grid"></div>
    </div>
  </section>

  <footer class="footer">
    <div class="container footer-content">
      <div class="logo footer-logo">
        <span class="logo-text">UniGuide</span>
      </div>
      <div class="footer-links">
         <a href="home.html" class="nav-link">Home</a>
        <a href="deadlines.html" class="nav-link">Deadlines</a>
        <a href="aggregateCalculator.html" class="nav-link">Aggregate Calculator</a>
        <a href="compare.html" class="nav-link">Compare Universities</a>
        <a href="chat.html" class="nav-link">AI Chat</a>
      </div>
      <p class="copyright">¬© 2025 UniGuide. All rights reserved.</p>
    </div>
  </footer>

  <script src="config.js"></script>
  <script src="chatWidget.js"></script>
  <script>
    const API_URL = CONFIG.API_URL;
    let allPrograms = [];
    let universities = [];

    // Program abbreviations mapping
    const programAbbreviations = {
      'cs': ['computer science', 'computer', 'software'],
      'it': ['information technology', 'computer'],
      'bba': ['business administration', 'business'],
      'mba': ['business administration', 'management'],
      'mbbs': ['medicine', 'medical', 'doctor'],
      'bds': ['dental', 'dentistry'],
      'llb': ['law', 'legal'],
      'pharm': ['pharmacy'],
      'eng': ['engineering'],
      'ee': ['electrical engineering', 'electrical'],
      'me': ['mechanical engineering', 'mechanical'],
      'ce': ['civil engineering', 'civil'],
      'ai': ['artificial intelligence', 'machine learning'],
      'ds': ['data science', 'data'],
      'se': ['software engineering', 'software']
    };

    async function loadUniversities() {
      try {
        const response = await fetch(`${API_URL}/api/universities`);
        if (!response.ok) throw new Error('Failed to load');

        universities = await response.json();
        document.getElementById('loading').style.display = 'none';
        
        const grid = document.getElementById('universities-grid');
        grid.innerHTML = '';

        universities.forEach(uni => {
          const card = document.createElement('div');
          card.className = 'uni-card';
          const shortName = uni.name;
          const fullName = uni.full_name;
          const city = uni.city;

          card.innerHTML = `
            <h3>${shortName}</h3>
            ${fullName && fullName !== shortName ? `<p>${fullName}</p>` : ''}
            <button onclick="window.location.href='university.html?name=${encodeURIComponent(shortName)}'" class="view-btn">
              View Details
            </button>`;

          grid.appendChild(card);
        });

        // Load all programs for search
        await loadAllPrograms();

      } catch (err) {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('error').style.display = 'block';
        document.getElementById('error').textContent = '‚ö†Ô∏è Error loading data';
      }
    }

    async function loadAllPrograms() {
      for (const uni of universities) {
        try {
          const res = await fetch(`${API_URL}/api/university/${encodeURIComponent(uni.name)}`);
          const data = await res.json();
          if (data.programs) {
            data.programs.forEach(p => {
              allPrograms.push({
                name: p.name,
                university: data.name,
                department: p.department || '',
                fee: p.total_fee_first_year
              });
            });
          }
        } catch (err) {
          console.error(`Error loading ${uni.name}:`, err);
        }
      }
      console.log(`Loaded ${allPrograms.length} programs for search`);
    }

    function smartSearch(query) {
      query = query.toLowerCase().trim();
      if (!query) return [];

      // Check if query is an abbreviation
      let searchTerms = [query];
      if (programAbbreviations[query]) {
        searchTerms = [...searchTerms, ...programAbbreviations[query]];
      }

      const results = allPrograms.filter(prog => {
        const progName = prog.name.toLowerCase();
        return searchTerms.some(term => progName.includes(term));
      });

      // Sort by relevance (exact match first)
      return results.sort((a, b) => {
        const aExact = a.name.toLowerCase().startsWith(query);
        const bExact = b.name.toLowerCase().startsWith(query);
        if (aExact && !bExact) return -1;
        if (!aExact && bExact) return 1;
        return 0;
      }).slice(0, 20); // Limit to 20 results
    }

    const programInput = document.getElementById('program-input');
    const dropdown = document.getElementById('program-dropdown');

    programInput.addEventListener('input', (e) => {
      const query = e.target.value;
      
      if (query.length < 2) {
        dropdown.classList.remove('show');
        return;
      }

      const results = smartSearch(query);
      
      if (results.length === 0) {
        dropdown.innerHTML = '<div class="no-results">No programs found</div>';
        dropdown.classList.add('show');
        return;
      }

      dropdown.innerHTML = results.map(prog => `
        <div class="dropdown-item" onclick="goToProgram('${prog.university.replace(/'/g, "\\'")}')">
          <div class="program-name">${prog.name}</div>
          <div class="program-meta">
            üèõÔ∏è ${prog.university} ‚Ä¢ üìÇ ${prog.department}
            ${prog.fee ? ` ‚Ä¢ üí∞ PKR ${prog.fee.toLocaleString()}` : ''}
          </div>
        </div>
      `).join('');
      
      dropdown.classList.add('show');
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.search-group')) {
        dropdown.classList.remove('show');
      }
    });

    function goToProgram(uniName) {
      window.location.href = `university.html?name=${encodeURIComponent(uniName)}`;
    }

    loadUniversities();
  </script>
  <script src="chatWidget.js"></script>
</body>
</html>